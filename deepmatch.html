<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>DeepMatch - æ„å›¾é©±åŠ¨åŒ¹é…</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* --- DeepSeek é£æ ¼å˜é‡ --- */
        :root {
            --ds-blue: #4d6bfe;
            --ds-blue-hover: #3b5bdb;
            --bg-body: #f9fafe;
            --bg-card: #ffffff;
            --text-main: #1f2329;
            --text-secondary: #86909c;
            --border-light: #e5e6eb;
            --shadow-md: 0 4px 12px rgba(0, 0, 0, 0.08);
            --radius-lg: 16px;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Inter', sans-serif;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            background-color: var(--bg-body);
            color: var(--text-main);
            height: 100vh;
            display: flex;
            justify-content: center;
            overflow: hidden;
        }

        #app {
            width: 100%;
            max-width: 600px;
            height: 100%;
            background-color: var(--bg-card);
            position: relative;
            display: flex;
            flex-direction: column;
            box-shadow: var(--shadow-md);
        }

        .page {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            display: none;
            flex-direction: column;
            background: var(--bg-card);
            z-index: 10;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .page.active {
            display: flex;
            opacity: 1;
        }

        /* --- 1. é¦–é¡µ (Home) --- */
        .home-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 30px;
        }

        .brand-area {
            text-align: center;
            margin-bottom: 40px;
        }

        .logo-text {
            font-size: 2rem;
            font-weight: 600;
            color: var(--text-main);
            letter-spacing: -0.5px;
        }
        
        .logo-sub {
            color: var(--text-secondary);
            font-size: 0.95rem;
            margin-top: 5px;
        }

        /* æ¨¡ä»¿ AI è¾“å…¥æ¡† */
        .prompt-box-wrapper {
            width: 100%;
            background: #fff;
            border: 1px solid var(--border-light);
            border-radius: var(--radius-lg);
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            padding: 15px;
            transition: all 0.2s;
            position: relative;
        }

        .prompt-box-wrapper:focus-within {
            border-color: var(--ds-blue);
            box-shadow: 0 0 0 3px rgba(77, 107, 254, 0.15);
        }

        .prompt-textarea {
            width: 100%;
            border: none;
            outline: none;
            resize: none;
            font-size: 1rem;
            line-height: 1.5;
            min-height: 100px;
            color: var(--text-main);
            background: transparent;
        }

        .prompt-textarea::placeholder {
            color: #bdc1c9;
        }

        .prompt-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 10px;
        }

        .model-tag {
            font-size: 0.75rem;
            color: var(--ds-blue);
            background: rgba(77, 107, 254, 0.1);
            padding: 4px 8px;
            border-radius: 6px;
            font-weight: 500;
        }

        .btn-submit {
            background-color: var(--ds-blue);
            color: white;
            border: none;
            border-radius: 8px;
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: background 0.2s;
        }
        
        .btn-submit:hover { background-color: var(--ds-blue-hover); }
        .btn-submit:disabled { background-color: #e5e6eb; cursor: not-allowed; }

        .suggestion-area {
            margin-top: 30px;
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
        }

        .suggestion-chip {
            font-size: 0.85rem;
            color: var(--text-secondary);
            background: #f7f8fa;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            border: 1px solid transparent;
            transition: all 0.2s;
        }

        .suggestion-chip:hover {
            background: #fff;
            border-color: var(--border-light);
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }

        /* --- 2. æ€è€ƒ/åŒ¹é…é¡µ (Reasoning) --- */
        .reasoning-container {
            flex: 1;
            padding: 40px 25px;
            display: flex;
            flex-direction: column;
        }

        .reasoning-status {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .spinner {
            width: 20px; height: 20px;
            border: 2px solid rgba(77, 107, 254, 0.3);
            border-top-color: var(--ds-blue);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin { to { transform: rotate(360deg); } }

        /* æ€ç»´é“¾æ—¥å¿—çª—å£ */
        .thought-chain {
            background: #f7f8fa;
            border-radius: 12px;
            padding: 20px;
            font-family: 'Courier New', Courier, monospace;
            font-size: 0.85rem;
            color: #555;
            line-height: 1.6;
            flex: 1;
            overflow-y: auto;
            border-left: 3px solid var(--ds-blue);
        }

        .log-item {
            margin-bottom: 8px;
            opacity: 0;
            animation: fadeIn 0.3s forwards;
        }
        
        .highlight { color: var(--ds-blue); font-weight: bold; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

        /* --- 3. èŠå¤©é¡µ (Chat) --- */
        /* å¤ç”¨ä¹‹å‰çš„èŠå¤©æ ·å¼ï¼Œç¨ä½œå¾®è°ƒ */
        .chat-header {
            height: 60px;
            border-bottom: 1px solid var(--border-light);
            display: flex; align-items: center; justify-content: space-between;
            padding: 0 15px; background: #fff;
        }
        .chat-body { flex: 1; padding: 20px; overflow-y: auto; display: flex; flex-direction: column; gap: 15px; }
        .msg { max-width: 80%; padding: 12px 16px; border-radius: 12px; font-size: 0.95rem; line-height: 1.5; }
        .msg.me { align-self: flex-end; background: var(--ds-blue); color: white; border-bottom-right-radius: 2px; }
        .msg.other { align-self: flex-start; background: #f2f3f5; color: var(--text-main); border-bottom-left-radius: 2px; }
        .input-bar { padding: 15px; background: #fff; display: flex; gap: 10px; border-top: 1px solid var(--border-light); }
        .chat-input { flex: 1; background: #f7f8fa; border: none; padding: 12px; border-radius: 20px; outline: none; }
        
    </style>
</head>
<body>

    <div id="app">
        <!-- 1. é¦–é¡µï¼šè‡ªç„¶è¯­è¨€è¾“å…¥ -->
        <div id="page-home" class="page active">
            <div class="home-container">
                <div class="brand-area">
                    <div class="logo-text">DeepMatch</div>
                    <div class="logo-sub">æè¿°ä½ çš„éœ€æ±‚ï¼ŒAI å°†ä¸ºä½ åŒ¹é…æœ€ä½³ç©ä¼´</div>
                </div>

                <div class="prompt-box-wrapper">
                    <textarea id="userInput" class="prompt-textarea" placeholder="åœ¨æ­¤è¾“å…¥... &#10;ä¾‹å¦‚ï¼šæ‰¾ä¸ªä»Šæ™šä¸€èµ·æ‰“ç“¦ç½—å…°ç‰¹æ’ä½çš„ï¼Œæˆ‘æ˜¯ç™½é“¶æ®µä½ï¼Œä¸»ç©çƒŸä½ã€‚"></textarea>
                    <div class="prompt-footer">
                        <span class="model-tag">DeepMatch-R1</span>
                        <button class="btn-submit" onclick="startDeepAnalysis()" id="submitBtn">
                            <i class="fas fa-arrow-up"></i>
                        </button>
                    </div>
                </div>

                <div class="suggestion-area">
                    <div class="suggestion-chip" onclick="fillInput('æˆ‘æƒ³æ‰¾äººä¸€èµ·ç©ã€Šé»‘ç¥è¯ï¼šæ‚Ÿç©ºã€‹ï¼Œäº¤æµéšè—Bossæ‰“æ³•')">ğŸµ é»‘ç¥è¯æ”»ç•¥äº¤æµ</div>
                    <div class="suggestion-chip" onclick="fillInput('ç“¦ç½—å…°ç‰¹å›½æœåŒæ’ï¼Œç™½é‡‘æ®µä½ï¼Œå¿ƒæ€å¥½ä¸å‹åŠ›')">ğŸ”« ç“¦ç½—å…°ç‰¹ä¸Šåˆ†</div>
                    <div class="suggestion-chip" onclick="fillInput('æ‰¾ä¸ªæ­å­ä¸€èµ·ç©ã€ŠåŒäººæˆè¡Œã€‹ï¼Œæˆ‘æ˜¯PCç‰ˆ')">ğŸ‘« åŒäººæˆè¡Œ</div>
                    <div class="suggestion-chip" onclick="fillInput('åˆšå…¥å‘ã€Šè‰¾å°”ç™»æ³•ç¯ã€‹ï¼Œæ±‚å¤§ä½¬å¸¦å¸¦è·¯')">ğŸ’ æ³•ç¯èŒæ–°</div>
                </div>
            </div>
        </div>

        <!-- 2. æ€è€ƒé¡µï¼šæ€ç»´é“¾å±•ç¤º -->
        <div id="page-matching" class="page">
            <div class="reasoning-container">
                <div class="reasoning-status">
                    <div class="spinner"></div>
                    <span>DeepMatch æ­£åœ¨æ€è€ƒ...</span>
                </div>
                <!-- è¿™é‡Œçš„æ—¥å¿—å°†åŠ¨æ€ç”Ÿæˆ -->
                <div class="thought-chain" id="thoughtLog"></div>
            </div>
            <div style="padding: 20px; text-align: center;">
                <button onclick="cancelMatch()" style="background:none; border:none; color:#888; cursor:pointer;">å–æ¶ˆ</button>
            </div>
        </div>

        <!-- 3. èŠå¤©é¡µ -->
        <div id="page-chat" class="page">
            <header class="chat-header">
                <i class="fas fa-chevron-left" onclick="location.reload()" style="cursor:pointer; color:#555;"></i>
                <div style="text-align: center;">
                    <div style="font-weight: 600;" id="partnerName">User</div>
                    <div style="font-size: 0.75rem; color: var(--ds-blue);" id="matchReason">åŒ¹é…åº¦ 98%</div>
                </div>
                <i class="fas fa-ellipsis-h" style="color:#555;"></i>
            </header>
            <div class="chat-body" id="chatBody"></div>
            <div class="input-bar">
                <input type="text" class="chat-input" id="chatInput" placeholder="å‘é€æ¶ˆæ¯...">
                <button onclick="sendMsg()" style="background:var(--ds-blue); color:white; border:none; width:36px; height:36px; border-radius:50%; cursor:pointer;"><i class="fas fa-paper-plane"></i></button>
            </div>
        </div>
    </div>

    <script>
        /* --- æ¨¡æ‹Ÿæ•°æ®åº“ --- */
        // ç³»ç»Ÿä¼šæ ¹æ®å…³é”®è¯åœ¨è¿™äº›ç”¨æˆ·ä¸­æŸ¥æ‰¾
        const mockDatabase = [
            { 
                id: "Agent_Viper", 
                keywords: ["ç“¦ç½—å…°ç‰¹", "valorant", "FPS", "æ’ä½", "ç™½é“¶", "é»„é‡‘", "çƒŸä½"],
                intro: "æˆ‘ä¸»ç©å¹½å½±å’Œè°è›‡ï¼Œç›®å‰é»„é‡‘2ï¼Œæ¯æ™š8ç‚¹åœ¨çº¿ï¼Œä¸å‹åŠ›ã€‚",
                reply: "å—¨ï¼çœ‹åˆ°ä½ ä¹Ÿç©ç“¦ï¼Œæˆ‘ä¹Ÿåœ¨æ‰¾æ’ä½æ­å­ï¼Œä½ é€šå¸¸å‡ ç‚¹åœ¨ï¼Ÿ"
            },
            { 
                id: "MonkeyKing", 
                keywords: ["é»‘ç¥è¯", "æ‚Ÿç©º", "wukong", "å‰§æƒ…", "boss"],
                intro: "å…¨æˆå°±è¾¾æˆï¼Œæ­£åœ¨ç ”ç©¶äºŒå‘¨ç›®ç»†èŠ‚ï¼Œæ¬¢è¿è®¨è®ºå‰§æƒ…ã€‚",
                reply: "å¤©å‘½äººä½ å¥½ï¼ä½ ç©åˆ°ç¬¬å‡ ç« äº†ï¼Ÿé‚£ä¸ªéšè—Bossç¡®å®éš¾æ‰“ã€‚"
            },
            { 
                id: "Tarnished_One", 
                keywords: ["è‰¾å°”ç™»æ³•ç¯", "æ³•ç¯", "è€å¤´ç¯", "èŒæ–°", "å¸¦äºº"],
                intro: "å‡ ç™¾å°æ—¶è€assäº†ï¼Œå–œæ¬¢å¸¦èŒæ–°å¼€è’ï¼ŒPCç«¯ã€‚",
                reply: "è¤ªè‰²è€…ä½ å¥½ï¼Œæˆ‘å¯ä»¥å¸¦ä½ è·‘å›¾ï¼Œåªè¦ä½ ä¸ä»‹æ„è¢«å…¥ä¾µå“ˆå“ˆã€‚"
            },
            { 
                id: "ItTakesTwo", 
                keywords: ["åŒäººæˆè¡Œ", "åˆä½œ", "ä¼‘é—²", "steam"],
                intro: "ä¹°äº†æ¸¸æˆä¸€ç›´æ²¡æ‰¾åˆ°äººç©ï¼Œå¸Œæœ›èƒ½æ‰¾ä¸ªæœ‰è€å¿ƒçš„é˜Ÿå‹ã€‚",
                reply: "å“‡ç»ˆäºæ‰¾åˆ°äººäº†ï¼Œæˆ‘ä¹°äº†å¾ˆä¹…ä¸€ç›´åƒç°ï¼Œæˆ‘ä»¬è¦ä¸ç”¨Discordè¯­éŸ³ï¼Ÿ"
            },
            {
                id: "Tech_Guru",
                keywords: ["æ˜¾å¡", "è£…æœº", "ç¡¬ä»¶", "é…ç½®"],
                intro: "èµ„æ·±åƒåœ¾ä½¬ï¼Œå–œæ¬¢ç ”ç©¶é…ç½®å•ã€‚",
                reply: "4090ç¡®å®è´µï¼Œæˆ‘è§‰å¾—å¦‚æœæ˜¯ä¸ºäº†ç©é»‘ç¥è¯ï¼Œ4070Ti Superæ€§ä»·æ¯”æ›´é«˜ã€‚"
            }
        ];

        /* --- é€»è¾‘éƒ¨åˆ† --- */

        function fillInput(text) {
            document.getElementById('userInput').value = text;
        }

        function showPage(pageId) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById(pageId).classList.add('active');
        }

        // æ ¸å¿ƒï¼šå¼€å§‹æ·±åº¦åˆ†æ
        function startDeepAnalysis() {
            const input = document.getElementById('userInput').value.trim();
            if (!input) {
                alert("è¯·è¾“å…¥ä¸€äº›å†…å®¹ï¼Œä¾‹å¦‚æ¸¸æˆåæˆ–ç©æ³•éœ€æ±‚ã€‚");
                return;
            }

            showPage('page-matching');
            const logContainer = document.getElementById('thoughtLog');
            logContainer.innerHTML = ''; // æ¸…ç©ºæ—¥å¿—

            // 1. å¯åŠ¨æ€ç»´é“¾æ¨¡æ‹Ÿ
            runThinkingProcess(input);
        }

        async function runThinkingProcess(input) {
            // å®šä¹‰æ€è€ƒæ­¥éª¤ï¼ˆæ¨¡æ‹Ÿ DeepSeek R1 çš„è¾“å‡ºé£æ ¼ï¼‰
            const steps = [
                `> æ¥æ”¶ç”¨æˆ·è¾“å…¥: "${input.substring(0, 15)}..."`,
                `> æ­£åœ¨è¿›è¡Œè¯­ä¹‰åˆ†è¯ä¸æ„å›¾è¯†åˆ«...`, 
                // åŠ¨æ€æ’å…¥æå–çš„å…³é”®è¯
                (cb) => {
                    const keywords = extractKeywords(input);
                    cb(`> æå–å…³é”®å®ä½“: [${keywords.join(', ')}]`);
                    return keywords;
                },
                `> æ­£åœ¨æ£€ç´¢å‘é‡æ•°æ®åº“ (Vector DB)...`,
                `> è®¡ç®—ä½™å¼¦ç›¸ä¼¼åº¦...`,
                (cb, prevData) => {
                    const bestMatch = findBestMatch(prevData); // ä½¿ç”¨æå–çš„å…³é”®è¯å»åŒ¹é…
                    cb(`> é”å®šæœ€ä½³åŒ¹é…å¯¹è±¡ ID: ${bestMatch.user.id} (ç½®ä¿¡åº¦: 0.9${Math.floor(Math.random()*9)})`);
                    return bestMatch;
                },
                `> æ­£åœ¨å»ºç«‹åŠ å¯†é€šé“...`
            ];

            let contextData = null; // ç”¨äºåœ¨æ­¥éª¤é—´ä¼ é€’æ•°æ®

            for (let step of steps) {
                await new Promise(r => setTimeout(r, 800 + Math.random() * 500)); // éšæœºå»¶è¿Ÿ
                
                let logText = "";
                if (typeof step === 'function') {
                    // å¦‚æœæ˜¯å‡½æ•°ï¼Œæ‰§è¡Œé€»è¾‘å¹¶è·å–è¿”å›å€¼
                    contextData = step((text) => { logText = text; }, contextData);
                } else {
                    logText = step;
                }

                addLog(logText);
            }

            // æ€è€ƒç»“æŸï¼Œè¿›å…¥èŠå¤©
            setTimeout(() => {
                enterChat(contextData);
            }, 1000);
        }

        // ç®€å•çš„å…³é”®è¯æå–é€»è¾‘
        function extractKeywords(text) {
            // è¿™é‡Œåªæ˜¯ç®€å•çš„æ­£åˆ™åŒ¹é…ï¼Œå®é™…é¡¹ç›®ä¸­ä¼šç”¨ NLP
            const potentialKeywords = ["ç“¦ç½—å…°ç‰¹", "valorant", "é»‘ç¥è¯", "æ‚Ÿç©º", "æ³•ç¯", "è‰¾å°”ç™»", "åŒäººæˆè¡Œ", "æ’ä½", "ä¼‘é—²", "ç™½é“¶", "é»„é‡‘", "FPS", "Steam", "è£…æœº", "ç¡¬ä»¶"];
            const found = potentialKeywords.filter(k => text.toLowerCase().includes(k.toLowerCase()));
            
            if (found.length === 0) return ["é€šç”¨åŒ¹é…", "æ¸¸æˆ"]; // å…œåº•
            return found;
        }

        // æ•°æ®åº“åŒ¹é…é€»è¾‘
        function findBestMatch(keywords) {
            let bestUser = mockDatabase[0];
            let maxScore = -1;

            mockDatabase.forEach(user => {
                let score = 0;
                keywords.forEach(k => {
                    // å¦‚æœç”¨æˆ·çš„å…³é”®è¯åˆ—è¡¨æˆ–ç®€ä»‹åŒ…å«æœç´¢è¯
                    if (user.keywords.some(uk => uk.toLowerCase().includes(k.toLowerCase())) || 
                        user.intro.includes(k)) {
                        score++;
                    }
                });
                
                if (score > maxScore) {
                    maxScore = score;
                    bestUser = user;
                }
            });

            // å¦‚æœå®Œå…¨æ²¡åŒ¹é…åˆ°ï¼ˆåˆ†æ•°0ï¼‰ï¼Œéšæœºè¿”å›ä¸€ä¸ªï¼Œé¿å…å°´å°¬
            if (maxScore === 0) {
                 bestUser = mockDatabase[Math.floor(Math.random() * mockDatabase.length)];
            }

            return { user: bestUser, score: maxScore };
        }

        function addLog(text) {
            const div = document.createElement('div');
            div.className = 'log-item';
            // é«˜äº®æ‹¬å·å†…çš„å†…å®¹
            div.innerHTML = text.replace(/\[(.*?)\]/g, '<span class="highlight">[$1]</span>');
            
            const container = document.getElementById('thoughtLog');
            container.appendChild(div);
            container.scrollTop = container.scrollHeight;
        }

        function cancelMatch() {
            showPage('page-home');
        }

        /* --- èŠå¤©é€»è¾‘ --- */
        let currentUser = null;

        function enterChat(matchResult) {
            currentUser = matchResult.user;
            showPage('page-chat');
            
            document.getElementById('partnerName').innerText = currentUser.id;
            document.getElementById('matchReason').innerText = `åŸºäºå…³é”®è¯: ${currentUser.keywords.slice(0,2).join(', ')}`;
            
            const chatBody = document.getElementById('chatBody');
            chatBody.innerHTML = ''; // æ¸…ç©ºæ—§è®°å½•
            
            // ç³»ç»Ÿæç¤º
            chatBody.innerHTML += `<div style="text-align:center; font-size:0.8rem; color:#ccc; margin-bottom:10px;">DeepMatch å·²å»ºç«‹è¿æ¥</div>`;

            // æ¨¡æ‹Ÿå¯¹æ–¹æ‰“æ‹›å‘¼
            setTimeout(() => {
                receiveMsg(currentUser.reply);
            }, 1000);
        }

        function sendMsg() {
            const input = document.getElementById('chatInput');
            const text = input.value.trim();
            if(!text) return;

            // æ·»åŠ æˆ‘çš„æ¶ˆæ¯
            const chatBody = document.getElementById('chatBody');
            chatBody.innerHTML += `<div class="msg me">${text}</div>`;
            input.value = '';
            chatBody.scrollTop = chatBody.scrollHeight;

            // æ¨¡æ‹Ÿå›å¤
            setTimeout(() => {
                receiveMsg("è¿™å°±æ˜¯ç¼˜åˆ†ï¼æˆ‘ç°åœ¨åˆšå¥½æœ‰ç©ºï¼Œè¦ä¸è¦åŠ ä¸ªå¥½å‹ï¼Ÿ");
            }, 2500);
        }

        function receiveMsg(text) {
            const chatBody = document.getElementById('chatBody');
            chatBody.innerHTML += `<div class="msg other">${text}</div>`;
            chatBody.scrollTop = chatBody.scrollHeight;
        }

        // å›è½¦å‘é€ç›‘å¬
        document.getElementById('chatInput').addEventListener('keypress', function (e) {
            if (e.key === 'Enter') sendMsg();
        });
    </script>
</body>
</html>